.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. _ngmobile_gui:

Пользовательский интерфейс
==========================

В пользовательском интерфейсе имеется четыре основных элемента:

* главное окно приложения;
* выезжающая панель дерева слоев;
* таблица объектов;
* окно настроек.

Интерфейс приложения выполнен в соответствии с руководством `Google Material design <http://www.google.com/design/spec/material-design/introduction.html>`_.

.. _ngmobile_main_activity:

Главное окно
------------

Главное окно приложения представлено на :numref:`ngmobile_main_activity_pic`.

.. figure:: _static/ngmobile_mainscreen_rus.png
   :name: ngmobile_main_activity_pic
   :align: center
   :height: 10cm
   
   Главное окно приложения.
   
   Цифрами обозначены: 1 - кнопка открытия панели дерева слоев; 2 - заголовок приложения; 3 – кнопка "Показать текущее местоположение"; 4 - кнопка "Загрузить/обновить геоданные"; 5 - кнопка контекстного меню; 6 - линейка измерений; 7 - карта; 8 - кнопка меню основных операций; 9 - панель статуса.
   
В зависимости от размера экрана в верхней панели инструментов может быть больше или меньше кнопок. 
Все, что не помещается на панель инструментов, переносится в меню (см. :numref:`ngmobile_main_activity_pic` п. 5).

**Панель инструментов** имеет следующий состав:

* Показать текущее местоположение;
* Загрузить или обновить геоданные;
* Начать запись трека;
* Настройки;
* Помощь.

В нижней части экрана может размещаться **панель статуса** (см. :numref:`ngmobile_main_activity_pic` п. 9) (если включена соответствующая опция: Настройки - Карта - Показать панель статуса). В панели статуса отображается следующая информация 
(при наличии зафиксированного местоположения):

* координаты (широта и долгота);
* источник сигнала позиционирования (сотовые сети/Wi-Fi или спутник), а также количество спутников, 
  которые фиксируют местоположение (если позиционирование осуществляется при помощи :term:`GPS`/:term:`ГЛОНАСС`);
* высота в метрах;
* скорость движения в км/ч.

В зависимости от размера экрана панель может занимать одну или две строки.

Карта (см. :numref:`ngmobile_main_activity_pic` п. 7) представляет собой набор растровых и векторных слоев. 
Порядок и видимость слоев настраивается при помощи дерева слоев (см. :ref:`ngmobile_layer_tree`).


При долгом удержании пальца на геометрии векторного слоя окно карты переходит в режим 
выбора действия. 

.. _ngmobile_layer_tree:

Дерево слоев
------------

Дерево слоев предназначено для просмотра состава карты и управлением видимостью и порядком слоев на карте. 
Дополнительные операции над слоями вынесены в отдельное меню слоя. Дерево слоев представлено 
на :numref:`ngmobile_layer_tree_pic`.

.. figure:: _static/ngmobile_layer_tree_new.png
   :name: ngmobile_layer_tree_pic
   :align: center
   :height: 10cm
   
   Дерево слоев карты.
   
   Цифрами обозначены: 1 - тип слоя; 2 - название слоя; 3 - кнопка переключения видимости слоя; 4 - кнопка "Добавить геоданные"; 5 - кнопка вызова контекстного меню слоя; 6 - контекстное меню слоя. 
      
Для изменения порядка слоев нужно выполнить долгое нажатие на экран устройства на слое, 
который необходимо переместить. Слой, на котором выполняется долгое нажатие, выделится 
синей рамкой. При этом список перейдет в режим Редактирования. Далее, не отнимая пальца 
от экрана и удерживая на слое, который необходимо переместить, перетащите слой в новую позицию на экране.

Для включения/выключения видимости слоя достаточно нажать на соответствующую кнопку (см. :numref:`ngmobile_layer_tree_pic`, п. 3).

Нажатие на кнопку "Добавить геоданные" на верхней панели инструментов (см. :numref:`ngmobile_layer_tree_pic`, п. 4) 
позволяет создавать векторные слои и импортировать векторные и растровые слои из локального хранилища Android, `каталога QuickMapServices <https://qms.nextgis.com/>`_, `nextgis.ru <https://my.nextgis.ru/signup/?next=/webgis/>`_ или `Веб ГИС <http://nextgis.ru/nextgis-web/>`_. Эта кнопка содержит меню следующего состава (см. :numref:`ngmobile_the_menu_button_Add_data_pic`):

* Создать слой;
* Открыть локальный;
* Добавить геосервис;
* Добавить из Веб ГИС.

.. figure:: _static/ngmobile_the_menu_button_Add_data.png
   :name: ngmobile_the_menu_button_Add_data_pic
   :align: center
   :height: 10cm
  
   Меню кнопки "Добавить геоданные".

Выбор пункта меню "Открыть локальный" открывает системный диалог выбора данных, в 
котором можно выбрать как локальные :term:`геоданные` (на карте памяти), так и с 
облачных хранилищ. Приложение позволяет загружать следующие геоданные:

* файл формата :term:`GeoJSON`;
* файл формата ZIP с тайловым кэшем;
* файл формата *.ngrc
* файл формата *.ngfp.

Подробнее о загрузке геоданных описано в разделе ":ref:`ngmobile_load_geodata`".

Контекстное меню слоя зависит от его типа (векторный или растровый). Нажатие кнопки 
Контекстное меню (см.: :numref:`ngmobile_layer_tree_pic`, п. 5) открывает контекстное меню, 
которое приведено в п.6 :numref:`ngmobile_layer_tree_pic`:

* Увеличить до охвата;
* Таблица объектов;
* Поделиться;
* Отправить в NextGIS;
* Редактировать;
* Удалить;
* Настройки.
 
.. warning::

   При выборе пункта "Удалить", слой удаляется с карты, а также удаляются все его данные с карты памяти.

.. _ngmobile_attributes_table:

Таблица объектов
-----------------

Таблица объектов предназначена для того, чтобы показывать содержимое каждого векторного слоя 
в формате таблицы и управлять им.

Для того чтобы открыть Таблицу объектов, необходимо активировать панель Дерева слоев 
и нажать на кнопку контекстного меню рядом с названием векторного слоя (см :numref:`ngmobile_layer_tree_pic`, п. 5). 
Это приведет к открытию контекстного меню, показаннного в п.6 :numref:`ngmobile_layer_tree_pic`. 
Далее необходимо выбрать пункт "Таблица объектов". В зависимости от размера экрана 
панель может раскрываться на весь экран или занимать правую часть экрана (слева отображается 
карта с подсвеченной геометрией текущего набора объектов).

Таблица объектов показана на :numref:`ngmobile_attributes_pic`.

.. figure:: _static/attribute_table_rus.png
   :name: ngmobile_attributes_pic
   :align: center
   :height: 10cm
   
   Таблица объектов.
   
При нажатии любой записи (строки) в таблице в нижней части экрана появится панель инструментов. 
Данная панель позволяет управлять опциями, показанными ниже на :numref:`ngmobile_attribute_table_toolbar_pic`.

.. figure:: _static/attribute_table_toolbar_rus.png
   :name: ngmobile_attribute_table_toolbar_pic
   :align: center
   :height: 10cm
   
   Панель инструментов таблицы объектов.
   
   Цифрами обозначены: 1 - закрыть таблицу объектов; 2 - название слоя; 3 - атрибуты объектов;  4 - закрыть панель инструментов; 5 - ID текущего объекта; 6 - показать текущий объект на карте; 7 - удалить текущий объект; 8 - открыть форму редактирования таблицы объектов.

Можно открыть стандартную форму редактирования таблицы объектов, выбрав опцию "Открыть форму редактирования таблицы объектов" (см. п.8 :numref:`ngmobile_attributes_pic`), как показано на :numref:`ngmobile_attribute_table_toolbar_pic`.
   
.. warning::

   При выборе пункта "Удалить" (см. :numref:`ngmobile_attribute_table_toolbar_pic` п.7) объект сразу же удаляется. Отмена удаления возможна только в течение 5 секунд после удаления, после этого объект будет удален безвозвратно.   

.. _ngmobile_settings:

Окно настроек
-------------

В зависимости от размера экрана окно настроек может быть однопанельным и двупанельным. 
Окно настроек представлено на :numref:`ngmobile_settings_pic` (однопанельный режим). 

.. figure:: _static/ngmobile_settings_new.png
   :name: ngmobile_settings_pic
   :align: center
   :height: 10cm
   
   Окно настроек.
   
На основной панели имеются следующие блоки настроек:

* Общие;
* Карта;
* Местоположение;
* Мои треки;
* Веб ГИС;
* Учетная запись.

Блок настроек "Общие" позволяет изменять основные настройки карты (см. :numref:`ngmobile_settings_general_pic`).

.. figure:: _static/ngmobile_settings_general_rus.png
   :name: ngmobile_settings_general_pic
   :align: center
   :height: 10cm

   Блок настроек "Общее".
  
  Здесь можно выбрать тему (Светлую или Темную) и настроить компас.

Блок настроек "Карта" содержит основные настройки карты (см. :numref:`ngmobile_settings_map_pic`).

.. figure:: _static/ngmobile_settings_map.png
   :name: ngmobile_settings_map_pic
   :align: center
   :height: 10cm
   
   Окно настроек карты.
   
Настройки карты имеют следующий состав:

* показать/скрыть панель статуса (информационную панель);
* каким образом показывать текущее местоположения (не показывать текущее местоположение, 
  показывать только маркер, показывать маркер и радиус точности);
* показывать мини компас;
* при показе карты не выключать экран (работает только в окне карты);
* отображать/скрыть кнопки управления масштабом (показывать кнопки +/- на карте для 
  увеличения/уменьшения, отображать шкалу масштаба);
* отображать/скрыть линейку измерений;
* формат вывода координат (действует на отображение координат в панели статуса и других диалогах и окнах);
* отображает количество разрядов после запятой (количество разрядов можно изменить);
* отображает фон карты (светлый, нейтральный, темный);
* путь к картам (можно указать свой путь к папки для хранения данных карты и слоев геоданных). 

.. note::

   В случае наличия устройства с несколькими SD карточками и ОС Android 4.4 (KitKat) и выше, путь к карте 
   на не основной SD карточке может быть указан только в домашнюю директорию приложения и ее подпапки 
   (например, Android/data/com.nextgis.mobile). Это справедливо для некоторых устройств без root прав.
   При отображении диалога выбора, папки, в которые запрещена запись, не будут иметь отметки для их выбора.

Блок настроек "Местоположения" содержит настройки местоположения (см. :numref:`ngmobile_settings_place_pic`).

.. figure:: _static/ngmobile_settings_place.png
   :name: ngmobile_settings_place_pic
   :align: center
   :height: 10cm
   
   Окно настроек местоположения.
  
Настройки местоположения имеют следующий состав:
  
* точность определения местоположения/источник координат (:term:`GPS`, другие сети, GPS & другие сети);
* минимальное время обновления координат;
* минимальное расстояние обновления для снятия координат;
* количество замеров GPS.

Настройка треков аналогична настройкам местоположения, но влияет только на запись треков.

.. note::

   Если поставить значение минимального расстояния получения координат более 5 м, то операционная система начинает сглаживать трек (убирает выбросы).
   
.. _ngmobile_useful_facilities:

Полезные опции
-----------------

В Главном окне можно получить доступ к нескольким опциям, полезным в поле.

.. _ngmobile_show_my_location:

Показать мое местоположение
^^^^^^^^^^^^^^^^^^^^^^^^^^^

Для того, чтобы узнать свое текущее местоположение, нужно нажать на кнопку "Показать текущее местоположение" (см. выше :numref:`ngmobile_main_activity_pic` п. 3). При этом на карте будет маркером отмечено текущее местоположение. Если на панели статуса (см. выше :numref:`ngmobile_main_activity_pic` п. 9) включены нужные настройки карты (см. :numref:`ngmobile_settings_map_pic`), то там же будет доступна важная информация.

.. note::
   Блок настроек "Местоположение" должен быть включен в настройках устройства Android.
   
Измерение расстояния
^^^^^^^^^^^^^^^^^^^^

Можно измерить расстояние между двумя точками на карте. Для этого нужно нажать на кнопку "Измерение" на экране карты (см. выше :numref:`ngmobile_main_activity_pic` п. 6). Нажмите на первую точку (в режиме редактирования на экране появится новая точка). Затем нажмите на вторую точку (в режиме редактирования на экране появится вторая точка и линия, соединяющая две точки). Расстояние между этими точками будет показано на верхней панели инструментов (см. :numref:`ngmobile_measure_distance_pic`).

.. figure:: _static/ngmobile_measure.png
   :name: ngmobile_measure_distance_pic
   :align: center
   :height: 10cm
   
   Измерение расстояния.

Можно добавить большее количество точек, чтобы измерить расстояние, образуемое сложными линиями и кривыми, а также измерить площадь образующихся полигонов.

Положение любой точки может быть изменено нажатием на нее и перемещением в нужную позицию.

Для того, чтобы выйти из режима измерения, нажмите на синюю галочку в углу экрана.

.. note::
   Для того, чтобы использовать эту опцию, в блоке настроек "Карта" должен быть отмечен пункт "Линейка измерений" (см. :numref:`ngmobile_settings_map_pic`).

   
