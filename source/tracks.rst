.. sectionauthor:: Дмитрий Барышников <dmitry.baryshnikov@nextgis.ru>

.. tracks:

Треки
=====

Программа позволяет записывать и отображать треки. В процессе записи сохраняются 
точки трека во внутреннюю базу данных. При отображении точки трека в рамках сессии 
объединяются и отображаются в виде линий на карте. 

.. note::
   Следует проверить, чтобы в настройках устройства Android был включен режим Местоположения. Также необходимо убедиться, что конфигурации настроек "Мои треки" и "Местоположение" в настройках NextGIS Mobile были установлены, как показано на :numref:`ngmobile_settings_place_pic`.

Запись
------

Трек может быть записан двумя путями.

Запись трека в формате GPX
^^^^^^^^^^^^^^^^^^^^^^^^^^

1. Для начала записи трека необходимо выбрать команду на панели инструментов или в меню (см. :numref:`ngmobile_track_menu_pic` п. 1 и 2 соответственно). 

.. figure:: _static/ngmobile_track_menu.png
   :name: ngmobile_track_menu_pic
   :align: center
   :width: 9cm
   
   Команда записи трека.
   
   Цифрами обозначено: 1 - кнопка на панели инструментов для записи трека; 2 - пункт меню для записи трека.

Запись трека выполняется независимо от приложения в фоновом процессе. Для индикации состояния выводится сообщение в панель 
статуса операционной системы (см. :numref:`ngmobile_status_track_pic`).

.. figure:: _static/ngmobile_status_track.png
   :name: ngmobile_status_track_pic
   :align: center
   :width: 7cm
 
   Статус записи трека.
   
   Цифрами обозначено: 1 - название сессии записи трека; 2 - кнопка завершения записи трека; 
   3 - кнопка активации приложения, из которого запущен процесс записи трека.
   
Записываемый трек сразу же рисуется на карте. Иконка статуса записи (шагающий человек) остается видна на панели статуса операционной системы. Зеленый флажок указывает на стартовую точку трека, маркер местоположения показывает текущее положение устройства.

.. note::
Точки трека группируются по дням и сессиям внутри одного дня. Если запись трека переходит на другой день, то он будет разбит на две части.

2. Для того, чтобы остановить запись, необходимо нажать на кнопку "Стоп" либо на панели статуса операционной системы, либо в контекстном меню (см. :numref:`ngmobile_main_activity_pic`, п.5). Иконка статуса исчезнет из панели состояния, маркер местоположения заменится на красный флажок, означающий конец трека, а линия трека изменит свой цвет.

3. После этого можно управлять этим треком, в том числе экспортировать его в формат GPX. Как это сделать, описано в разделе "Выгрузка треков в GPX".

Запись трека на векторный слой
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

С помощью трекинга можно также добавить объект на существующий линейный или полигональный векторный слой.

1. Для начала записи трека необходимо выбрать команду "Добавить геометрию обходом" в меню (см. :numref:`ngmobile_main_activity_pic`, п.5). Это откроет список всех редактируемых линейный/мультилинейных и полигональных/мультиполигональных слоев в виде отдельного диалога.

2. Затем следует выбрать слой, на который нужно добавить обходом новый объект. Этот слой откроется в режиме Редактирования и NextGIS Mobile начнет запись новой геометрии на векторный слой.

Управление
----------

Треки представлены в дереве слоев (см. :numref:`ngmobile_layer_tree_traks_pic`) в виде группового слоя.

.. figure:: _static/ngmobile_layer_tree_traks.png
   :name: ngmobile_layer_tree_traks_pic
   :align: center
   :height: 10cm
 
   Дерево слоев с записанными треками.
 
Для осуществления операций над групповым слоем нужно выбрать пункт меню Список. 
Над групповым слоем можно выполнить следующие операции:
    
* включение/выключение видимости группового слоя (треков);
* отображение окна управления треками (см. :numref:`ngmobile_settings_track_pic`).

.. figure:: _static/ngmobile_settings_track.png
   :name: ngmobile_settings_track_pic
   :align: center
   :height: 10cm
 
   Окно управления треками.
   
   Слева направо на панели инструментов обозначено: 
   1. число/количество выделенных треков; 
   2. значок палитры для присвоения цвета каждому треку;
   3. кнопка Поделиться;
   4. кнопка открытия контекстного меню.

Для присвоения каждому треку желаемого цвета следует выбрать на панели инструментов 
значок в виде палитры. Откроется окно с диалогом выбора цвета для изменения/задания 
цвета для трека (см. :numref:`ngmobile_color_of_track_pic`):

.. figure:: _static/ngmobile_color_of_track.png
   :name: ngmobile_color_of_track_pic
   :align: center
   :height: 10cm
 
   Окно с диалогом выбора цвета для треков.

Контекстное меню содержит следующие пункты:

1. Показать, включить видимость выделенного трека.
2. Скрыть, выключить видимость выделенного трека.
3. Удалить, удаление выделенного треков.
4. Выбрать все, выделение всех треков из списка.

На экране представлен список треков. Напротив каждого трека - окошко для проставления 
отметки/галочки или кнопка для выбора/выделения трека и кнопка включения/выключения видимости треков. 
Над выделенными треками можно выполнять следующие операции:
    
* включение/выключение видимости трека;
* удаление.

В окне управления треками представлен их список. Точки треков сгруппированы по дням и по сессиям внутри дня. 
При открытии окна управления треками ни один из треков не будет выделен. В таком режиме можно только менять 
видимость отдельных треков. Для выполнения операций над группами треков их необходимо выделить (см. :numref:`ngmobile_settings_track_pic`). После выделения хотя бы одного трека, окно примет вид, представленный на :numref:`ngmobile_settings_track_pic`. .

